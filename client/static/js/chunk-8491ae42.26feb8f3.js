(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8491ae42"],{"807e":function(t,e,a){"use strict";a("9fc4")},"9fc4":function(t,e,a){},ba76:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page-container"},[a("div",{staticClass:"table-container"},[a("el-tag",[t._v("活動序號")]),t.checkPermission(["修改活動序號"])?a("el-button",{staticStyle:{float:"right"},attrs:{icon:"el-icon-plus",type:"primary",circle:""},on:{click:t.add}}):t._e(),a("el-tabs",{staticStyle:{"margin-top":"10px"},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},t._l(t.tabMapOptions,(function(e){return a("el-tab-pane",{key:e.key,attrs:{label:e.label,name:e.key}},[a("Code",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{"table-data":t.filterData(t.tableData)},on:{edit:t.edit,initdata:t.initdata}})],1)})),1)],1),a("Dialog",{ref:"dialog",on:{initdata:t.initdata}})],1)},n=[],o=(a("4de4"),a("2909")),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-table",{attrs:{data:t.tableData,border:""}},[t.checkPermission(["修改活動序號"])?a("el-table-column",{attrs:{prop:"operating",label:"功能",width:"250"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return t.edit("編輯",e.row)}}},[t._v("瀏覽")]),a("el-button",{attrs:{type:"primary",size:"small"}},[t._v("查看序號")]),a("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(a){return t.remove(e.row.id)}}},[t._v("刪除")])]}}],null,!1,691526982)}):t._e(),a("el-table-column",{attrs:{prop:"id",label:"編號",width:"100"}}),a("el-table-column",{attrs:{prop:"title",label:"標題",width:"180"}}),a("el-table-column",{attrs:{prop:"type",label:"類型",width:"140"}}),a("el-table-column",{attrs:{prop:"amount",label:"數量",width:"100"}}),a("el-table-column",{attrs:{prop:"status",label:"狀態",width:"100"}}),a("el-table-column",{attrs:{prop:"startdate",label:"開始時間",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("moment")(e.row.startdate))+" ")]}}])}),a("el-table-column",{attrs:{prop:"enddate",label:"結束時間",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("moment")(e.row.enddate))+" ")]}}])}),a("el-table-column",{attrs:{prop:"creator",label:"建立者",width:"100"}}),a("el-table-column",{attrs:{prop:"content",label:"內容"}})],1),a("div",{staticClass:"table-pagination"},[a("el-pagination",{attrs:{"current-page":1,"page-sizes":[100,200,300,400],"page-size":100,layout:"total, sizes, prev, pager, next, jumper",total:t.tableData.length},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)},i=[],s=a("b775");function c(t){return Object(s["a"])({url:"operation_getactivitycode",method:"get",data:t})}function d(t){return Object(s["a"])({url:"operation_createactivitycode",method:"post",data:t})}function u(t){return Object(s["a"])({url:"operation_deleteactivitycode",method:"post",data:t})}var f=a("e350"),m={name:"Item",props:{tableData:{type:Array,default:function(){return[]}}},data:function(){return{}},methods:{checkPermission:f["a"],handleSizeChange:function(t){console.log("每页 ".concat(t," 条"))},handleCurrentChange:function(t){console.log("当前页: ".concat(t))},edit:function(t,e){this.$emit("edit",{title:t,row:e})},remove:function(t){var e=this,a=new FormData;a.append("id",t),u(a).then((function(t){var a=t.data;a.success?(e.$emit("initdata"),e.$message.success(a.msg)):e.$message.warning(a.msg)})).catch((function(t){console.log(t)}))}}},p=m,h=(a("807e"),a("2877")),b=Object(h["a"])(p,l,i,!1,null,"3e2d79bb",null),g=b.exports,D=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:t.title,"before-close":t.handleClose,visible:t.dialogFormVisible,width:"630px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"ruleForm",attrs:{rules:t.rules,model:t.formData}},[a("el-form-item",{attrs:{prop:"title",label:"標題","label-width":t.formLabelWidth}},[a("el-input",{attrs:{autocomplete:"off",placeholder:"請輸入標題"},model:{value:t.formData.title,callback:function(e){t.$set(t.formData,"title",e)},expression:"formData.title"}})],1),a("el-form-item",{attrs:{prop:"type",label:"類型","label-width":t.formLabelWidth}},[a("el-select",{staticClass:"form-margin form-width",attrs:{placeholder:"請選擇類型"},model:{value:t.formData.type,callback:function(e){t.$set(t.formData,"type",e)},expression:"formData.type"}},[a("el-option",{attrs:{label:"活動獎品型（單次單人使用）",value:"活動獎品型"}}),a("el-option",{attrs:{label:"社群媒體型（單次多人使用）",value:"社群媒體型"}})],1),a("el-input",{staticClass:"form-width",attrs:{autocomplete:"off",placeholder:"請輸入序號數量"},model:{value:t.formData.amount,callback:function(e){t.$set(t.formData,"amount",e)},expression:"formData.amount"}})],1),a("el-form-item",{attrs:{prop:"startdate",label:"日期","label-width":t.formLabelWidth}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"請選擇開始日期時間","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.formData.startdate,callback:function(e){t.$set(t.formData,"startdate",e)},expression:"formData.startdate"}})],1),a("el-form-item",{attrs:{prop:"enddate","label-width":t.formLabelWidth}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"請選擇下架日期時間","value-format":"yyyy-MM-dd HH:mm:ss","picker-options":t.pickerOptions},model:{value:t.formData.enddate,callback:function(e){t.$set(t.formData,"enddate",e)},expression:"formData.enddate"}})],1),a("el-form-item",{attrs:{label:"道具","label-width":t.formLabelWidth}},[a("el-table",{staticStyle:{width:"400px"},attrs:{data:t.tableData,border:""}},[a("el-table-column",{attrs:{label:"道具名稱"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.row.propValue,callback:function(a){t.$set(e.row,"propValue",a)},expression:"scope.row.propValue"}},t._l(e.row.props,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),1)]}}])}),a("el-table-column",{attrs:{label:"道具數量",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{model:{value:e.row.quantity,callback:function(a){t.$set(e.row,"quantity",t._n(a))},expression:"scope.row.quantity"}})]}}])}),a("el-table-column",{attrs:{align:"center",width:"60px"},scopedSlots:t._u([{key:"default",fn:function(e){return[0===e.row.index?a("el-button",{attrs:{icon:"el-icon-plus",type:"primary",circle:""},on:{click:t.doAdd}}):a("el-button",{attrs:{icon:"el-icon-minus",type:"danger",circle:""},on:{click:function(a){return t.doDelete(e.row.index)}}})]}}])})],1)],1),a("el-form-item",{attrs:{prop:"content",label:"內容","label-width":t.formLabelWidth}},[a("el-input",{attrs:{type:"textarea",rows:6,placeholder:"請輸入信件內容"},model:{value:t.formData.content,callback:function(e){t.$set(t.formData,"content",e)},expression:"formData.content"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.handleClose}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.createCode}},[t._v("建 立")])],1)],1)],1)},v=[],y=(a("4160"),a("a434"),a("b64b"),a("159b"),a("c1df")),w=a.n(y),k={data:function(){return{formData:{title:"",type:"",startdate:"",enddate:"",content:""},dialogFormVisible:!1,isStartDateError:!1,formLabelWidth:"80px",title:"新增序號",index:1,tableData:[{index:0,propValue:"",props:["道具1","道具2","道具3"],quantity:1}],rules:{title:[{required:!0,message:"請輸入標題",trigger:"change"}],type:[{required:!0,message:"請選擇類型",trigger:"change"}],startdate:[{required:!0,trigger:"change",validator:this.handleStartDate}],enddate:[{required:!0,trigger:"change",validator:this.handleEndDate}],content:[{required:!0,message:"請輸入內容",trigger:"change"}]}}},computed:{pickerOptions:function(){var t=this;return{disabledDate:function(e){return!t.isStartDateError&&w()(e)<w()(t.formData.startdate)}}}},methods:{resetFormData:function(){this.formData={title:"",type:"",startdate:"",enddate:"",content:""}},handleClose:function(t){var e=this;this.loading=!1,this.dialogFormVisible=!1,this.resetFormData(),this.$nextTick((function(){e.$refs["ruleForm"].clearValidate(Object.keys(e.formData))}))},handleOpen:function(t,e){this.dialogFormVisible=!0,this.title=t+"序號","編輯"===t&&(this.formData=Object.assign({},e),this.formData.startdate=new Date(this.formData.startdate),this.formData.enddate=new Date(this.formData.enddate))},handleStartDate:function(t,e,a){e&&w()(e)>w()(this.formData.enddate)?(this.isStartDateError=!0,a(new Error("請選擇正確的開始日期時間"))):e?(this.isStartDateError=!1,a()):a(new Error("開始日期時間不得為空"))},handleEndDate:function(t,e,a){if(e&&w()(e)<w()(this.formData.startdate))return a(new Error("請選擇正確的結束日期時間"));e?(this.formData.startdate&&this.$refs["ruleForm"].validateField(["startdate"]),this.isStartDateError=!1,a()):a(new Error("結束日期時間不得為空"))},createCode:function(){var t=this;this.$refs["ruleForm"].validate((function(e){if(e){var a=new FormData;a.append("title",t.formData.title),a.append("type",t.formData.type),a.append("amount",t.formData.amount),a.append("startdate",t.formData.startdate),a.append("enddate",t.formData.enddate),a.append("content",t.formData.content),d(a).then((function(e){var a=e.data;a.success?(t.$emit("initdata"),t.$message.success(a.msg)):t.$message.warning(a.msg),t.handleClose()})).catch((function(t){console.log(t)}))}}))},doAdd:function(){if(this.tableData.length>=5)this.$message.error("最多附加5樣");else{var t=this.index++;this.tableData.push({index:t,propValue:"",props:["道具1","道具2","道具3"],quantity:1})}},doDelete:function(t){this.tableData.forEach((function(e,a,r){e.index===t&&r.splice(a,1)}))}}},_=k,x=(a("f50b"),Object(h["a"])(_,D,v,!1,null,"fb50e0aa",null)),$=x.exports,C={name:"ActivityCode",components:{Dialog:$,Code:g},data:function(){return{loading:!0,tabMapOptions:[{label:"序號欄",key:"all"},{label:"進行中",key:"inProgress"},{label:"未進行",key:"notStart"},{label:"已結束",key:"finished"}],activeName:"all",tableData:[]}},computed:{},created:function(){this.tableData=this.initData},mounted:function(){this.initdata()},methods:{checkPermission:f["a"],add:function(){this.$refs.dialog.handleOpen("新增")},edit:function(t){var e=t.title,a=t.row;this.$refs.dialog.handleOpen(e,a)},filterData:function(){switch(this.activeName){case"inProgress":return this.tableData.filter((function(t,e,a){return"上架中"===t.status}));case"notStart":return this.tableData.filter((function(t,e,a){return"未上架"===t.status}));case"finished":return this.tableData.filter((function(t,e,a){return"已下架"===t.status}));case"all":return this.tableData}},initdata:function(){var t=this;this.loading=!0;var e="";switch(this.activeName){case"launched":e="0";break;case"notLaunch":e="1";break;case"removed":e="2";break}var a=new FormData;a.append("state",e),c(a).then((function(e){var a=e.data;a.success?t.tableData=Object(o["a"])(a.content):(t.tableData=[],t.$message.warning(a.msg)),t.loading=!1})).catch((function(t){console.log(t)}))}}},S=C,O=Object(h["a"])(S,r,n,!1,null,null,null);e["default"]=O.exports},e350:function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));a("caad"),a("45fc"),a("ac1f"),a("2532"),a("1276");var r=a("4360");function n(t){if(t&&t instanceof Array&&t.length>0){var e=r["a"].getters&&r["a"].getters.roles,a=e.split(","),n=t,o=a.some((function(t){return n.includes(t)}));return o}return console.error("need roles! Like v-permission=\"['admin','editor']\""),!1}},eaf8:function(t,e,a){},f50b:function(t,e,a){"use strict";a("eaf8")}}]);