(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-476c8f08"],{"2fa3":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page-container"},[a("div",{staticClass:"table-container"},[a("el-tag",[t._v("線上公告")]),t.checkPermission(["修改線上公告"])?a("el-button",{staticStyle:{float:"right","margin-left":"10px"},attrs:{icon:"el-icon-plus",type:"primary",circle:""},on:{click:t.add}}):t._e(),a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:t.handleCategory}},[t._v(" 編輯分類 ")]),a("el-tabs",{staticStyle:{"margin-top":"10px"},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},t._l(t.tabMapOptions,(function(e){return a("el-tab-pane",{key:e.key,attrs:{label:e.label,name:e.key},on:{"tab-click":t.changeTab}},[a("Announcement",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{"table-data":t.filterData()},on:{edit:t.edit,initdata:t.initdata}})],1)})),1)],1),a("AddAcounts",{ref:"addAcounts",attrs:{"form-data":t.formData},on:{setInit:t.setInit}}),a("Dialog",{ref:"dialog",on:{initdata:t.initdata}})],1)},o=[],i=(a("4de4"),a("d81d"),a("ac1f"),a("1276"),a("5530")),r=a("2909"),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-table",{attrs:{data:t.tableData,border:"","row-key":"id"}},[t.checkPermission(["修改線上公告"])?a("div",[a("el-table-column",{attrs:{prop:"\n      operating",label:"功能",width:"240"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return t.edit("編輯",e.row)}}},[t._v("編輯")]),"1"===e.row.status?a("el-button",{attrs:{type:"success",size:"small"},on:{click:function(a){return t.lanuch("on",e.row)}}},[t._v("立即上架")]):t._e(),"2"===e.row.status?a("el-button",{attrs:{type:"warning",size:"small"},on:{click:function(a){return t.lanuch("off",e.row)}}},[t._v("立即下架")]):t._e(),"2"!==e.row.status?a("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(a){return t.remove(e.row.id,e.row.status)}}},[t._v("刪除")]):t._e()]}}],null,!1,2143466749)})],1):t._e(),a("el-table-column",{attrs:{prop:"title",label:"標題",width:"150"}}),a("el-table-column",{attrs:{prop:"category",label:"類型",width:"100"}}),a("el-table-column",{attrs:{prop:"status",label:"狀態",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.getState(e.row.status))+" ")]}}])}),a("el-table-column",{attrs:{prop:"onsaleDate",label:"上架時間",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.TransformTime(e.row.onsaleDate))+" ")]}}])}),a("el-table-column",{attrs:{prop:"nosaleDate",label:"下架時間",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.TransformTime(e.row.nosaleDate))+" ")]}}])}),a("el-table-column",{attrs:{prop:"creator",label:"建立者",width:"100"}}),a("el-table-column",{attrs:{prop:"content",label:"內容"}})],1),a("div",{staticClass:"table-pagination"},[a("el-pagination",{attrs:{"current-page":1,"page-sizes":[100,200,300,400],"page-size":100,layout:"total, sizes, prev, pager, next, jumper",total:t.tableData.length},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)},s=[],c=a("e350"),u=a("c1df"),d=a.n(u),f=a("b775");function m(){return Object(f["a"])({url:"/operation/announce",method:"get"})}function h(t){return Object(f["a"])({url:"/operation/announce",method:"post",data:t})}function p(t){return Object(f["a"])({url:"/operation/announce",method:"put",data:t})}function g(t){return Object(f["a"])({url:"/operation/announce",method:"delete",data:t})}function b(){return Object(f["a"])({url:"/operation/announce/category",method:"get"})}function D(t){return Object(f["a"])({url:"/operation/announce/category",method:"put",data:t})}a("caad"),a("45fc"),a("2532");var v=a("4360");function y(t,e){var a=e.value,n=v["a"].getters&&v["a"].getters.roles;if(!(a&&a instanceof Array))throw new Error("need roles! Like v-permission=\"['admin','editor']\"");if(a.length>0){var o=n.split(","),i=a,r=o.some((function(t){return i.includes(t)}));r||t.parentNode&&t.parentNode.removeChild(t)}}var k={inserted:function(t,e){y(t,e)},update:function(t,e){y(t,e)}},w=function(t){t.directive("permission",k)};window.Vue&&(window["permission"]=k,Vue.use(w)),k.install=w;var $=k,_=a("5f87"),O={name:"Announcement",directives:{permission:$},props:{tableData:{type:Array,default:function(){return[]}}},data:function(){return{}},methods:{checkPermission:c["a"],handleSizeChange:function(t){console.log("每页 ".concat(t," 条"))},handleCurrentChange:function(t){console.log("当前页: ".concat(t))},edit:function(t,e){this.$emit("edit",{title:t,row:e})},remove:function(t,e){var a=this,n=new FormData;n.append("id",t),g(n).then((function(t){var e=t.data;e.success?(a.$emit("initdata"),a.$message.success(e.msg)):a.$message.warning(e.msg)})).catch((function(t){console.log(t)}))},lanuch:function(t,e){var a=this,n=new FormData;n.append("title",e.title),n.append("category",e.category),"on"===t?(n.append("onsaleDate",d()().valueOf()),n.append("nosaleDate",e.nosaleDate)):(n.append("onsaleDate",e.onsaleDate),n.append("nosaleDate",d()().valueOf())),n.append("content",e.content),n.append("id",e.id),n.append("token",Object(_["a"])()),p(n).then((function(t){var e=t.data;e.success?(a.$emit("initdata"),a.$message.success(e.msg)):a.$message.warning(e.msg)})).catch((function(t){console.log(t)}))},getState:function(t){switch(t){case"1":return"未上架";case"2":return"上架中";case"3":return"已下架"}},TransformTime:function(t){return d()(t).format("YYYY-MM-DD HH:mm:ss")}}},L=O,C=(a("360d"),a("2877")),x=Object(C["a"])(L,l,s,!1,null,"5ec442fa",null),A=x.exports,F=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:t.title,"close-on-click-modal":!1,"before-close":t.handleClose,visible:t.dialogFormVisible,width:"50%"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"ruleForm",attrs:{rules:t.rules,model:t.formData}},[a("el-form-item",{attrs:{prop:"title",label:"標題","label-width":t.formLabelWidth}},[a("el-input",{attrs:{autocomplete:"off",placeholder:"請輸入標題"},model:{value:t.formData.title,callback:function(e){t.$set(t.formData,"title",e)},expression:"formData.title"}})],1),a("el-form-item",{attrs:{prop:"category",label:"分類","label-width":t.formLabelWidth}},[a("el-select",{attrs:{placeholder:"請選擇分類",filterable:"","allow-create":"","default-first-option":""},model:{value:t.formData.category,callback:function(e){t.$set(t.formData,"category",e)},expression:"formData.category"}},t._l(t.accountList,(function(t){return a("el-option",{key:t.key,attrs:{label:t.label,value:t.label}})})),1)],1),a("el-form-item",{attrs:{prop:"onsaleDate",label:"日期","label-width":t.formLabelWidth}},[a("el-date-picker",{staticClass:"form-margin",attrs:{type:"datetime",placeholder:"請選擇上架日期時間","value-format":"yyyy-MM-dd HH:mm:ss",disabled:t.checked},model:{value:t.formData.onsaleDate,callback:function(e){t.$set(t.formData,"onsaleDate",e)},expression:"formData.onsaleDate"}}),a("el-checkbox",{on:{change:t.doCheck},model:{value:t.checked,callback:function(e){t.checked=e},expression:"checked"}},[t._v("立即上架")])],1),a("el-form-item",{attrs:{prop:"nosaleDate","label-width":t.formLabelWidth}},[a("el-date-picker",{staticClass:"form-margin",attrs:{type:"datetime",placeholder:"請選擇下架日期時間","value-format":"yyyy-MM-dd HH:mm:ss","picker-options":t.pickerOptions},model:{value:t.formData.nosaleDate,callback:function(e){t.$set(t.formData,"nosaleDate",e)},expression:"formData.nosaleDate"}})],1),a("el-form-item",{attrs:{prop:"content",label:"內容","label-width":t.formLabelWidth}},[a("el-input",{attrs:{type:"textarea",rows:6,placeholder:"請輸入公告內容"},model:{value:t.formData.content,callback:function(e){t.$set(t.formData,"content",e)},expression:"formData.content"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.handleClose}},[t._v("取 消")]),"新增公告"===t.title?a("el-button",{attrs:{type:"primary"},on:{click:t.createAnnounce}},[t._v("建 立")]):t._e(),"編輯公告"===t.title?a("el-button",{attrs:{type:"primary"},on:{click:t.updateAnnounce}},[t._v("更 新")]):t._e()],1)],1)],1)},S=[],j=(a("b64b"),{components:{},data:function(){return{formData:{title:"",category:"",onsaleDate:"",nosaleDate:"",content:""},checked:!1,dialogFormVisible:!1,isOnSaleDateError:!1,formLabelWidth:"80px",title:"新增公告",rules:{title:[{required:!0,message:"請輸入標題",trigger:"change"}],category:[{required:!0,message:"請輸入類型名稱",trigger:"change"}],onsaleDate:[{required:!0,trigger:"change",validator:this.handleOnSaleDate}],nosaleDate:[{required:!0,trigger:"change",validator:this.handleNoSaleDate}],content:[{required:!0,message:"請輸入內容",trigger:"change"}]}}},computed:{pickerOptions:function(){var t=this;return{disabledDate:function(e){return!t.isOnSaleDateError&&d()(e)<d()(t.formData.onsaleDate)}}},accountList:function(){var t=this.$parent.formData.accountList;return t[0]&&t[0].label?t:[]}},methods:{resetFormData:function(){this.formData={title:"",category:"",onsaleDate:"",nosaleDate:"",content:""}},handleClose:function(t){var e=this;this.loading=!1,this.dialogFormVisible=!1,this.checked=!1,this.resetFormData(),this.$nextTick((function(){e.$refs["ruleForm"].clearValidate(Object.keys(e.formData))}))},handleOpen:function(t,e){this.dialogFormVisible=!0,this.title=t+"公告","編輯"===t&&(this.formData=Object.assign({},e),this.formData.onsaleDate=new Date(this.formData.onsaleDate),this.formData.nosaleDate=new Date(this.formData.nosaleDate))},handleOnSaleDate:function(t,e,a){e&&d()(e)>d()(this.formData.nosaleDate)?(this.isOnSaleDateError=!0,a(new Error("上架時間不可大於下架時間"))):e?(this.isOnSaleDateError=!1,a()):a(new Error("上架日期不得為空"))},handleNoSaleDate:function(t,e,a){if(e&&d()(e)<d()(this.formData.onsaleDate))return a(new Error("下架時間不可小於上架時間"));e?(this.formData.onsaleDate&&this.$refs["ruleForm"].validateField(["onsaleDate"]),this.isOnSaleDateError=!1,a()):a(new Error("下架日期不得為空"))},createAnnounce:function(){var t=this;this.$refs["ruleForm"].validate((function(e){if(e){var a=new FormData;a.append("title",t.formData.title),a.append("category",t.formData.category),a.append("onsaleDate",t.getdatetime(t.formData.onsaleDate)),a.append("nosaleDate",t.getdatetime(t.formData.nosaleDate)),a.append("content",t.formData.content),a.append("token",Object(_["a"])()),h(a).then((function(e){t.$emit("initdata"),t.handleClose()})).catch((function(t){console.log(t)}))}}))},updateAnnounce:function(){var t=this;this.$refs["ruleForm"].validate((function(e){if(e){var a=new FormData;a.append("id",t.formData.id),a.append("title",t.formData.title),a.append("category",t.formData.category),a.append("onsaleDate",t.getdatetime(t.formData.onsaleDate)),a.append("nosaleDate",t.getdatetime(t.formData.nosaleDate)),a.append("content",t.formData.content),a.append("token",Object(_["a"])()),p(a).then((function(e){var a=e.data;a.success?(t.$emit("initdata"),t.$message.success(a.msg)):t.$message.warning(a.msg),t.dialogFormVisible=!1})).catch((function(t){console.log(t)}))}}))},open:function(t){this.$message({message:t,type:"warning"})},getdatetime:function(t){return d()(t).valueOf()},doCheck:function(t){t?this.$set(this.formData,"onsaleDate",d()().format("YYYY-MM-DD HH:mm:ss")):this.$set(this.formData,"onsaleDate","")}}}),E=j,V=(a("cba5"),Object(C["a"])(E,F,S,!1,null,"44977dd2",null)),N=V.exports,z=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{attrs:{title:t.title,"before-close":t.handleClose,"close-on-click-modal":!1,visible:t.dialogFormVisible,width:"550px"}},[a("el-form",{attrs:{model:t.formData}},t._l(t.formData.accountList,(function(e,n){return a("el-form-item",{key:e.key,attrs:{label:0===n?"分類名稱":"","label-width":t.formLabelWidth}},[a("el-input",{staticClass:"form-width form-margin",attrs:{disabled:e.disabled},model:{value:e.label,callback:function(a){t.$set(e,"label","string"===typeof a?a.trim():a)},expression:"category.label"}}),a("el-button",{attrs:{disabled:e.disabled},on:{click:function(a){return a.preventDefault(),t.removeAccount(e)}}},[t._v("删除")]),0==n?a("el-button",{on:{click:t.addAccount}},[t._v("新增分類")]):t._e()],1)})),1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.handleClose}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.addAccounts}},[t._v("確 認")])],1)],1)],1)},M=[],I=(a("4160"),a("c975"),a("a434"),a("d3b7"),a("25f0"),a("6062"),a("3ca3"),a("159b"),a("ddb0"),a("cd3f")),T={name:"AddAccounts",data:function(){return{dialogFormVisible:!1,formLabelWidth:"80px",title:"編輯分類",initData:{},formData:{accountList:[]}}},methods:{handleClose:function(t){this.loading=!1,this.dialogFormVisible=!1},handleOpen:function(t,e){var a=this;this.dialogFormVisible=!0;var n=this.$parent.tableData.map((function(t){return t.category}));this.formData=I(this.$parent.formData),this.formData.accountList.forEach((function(t,e,o){-1!==n.indexOf(t.label)&&a.$set(t,"disabled",!0)})),this.createInit()},removeAccount:function(t){if(1!==this.formData.accountList.length){var e=this.formData.accountList.indexOf(t);-1!==e&&this.formData.accountList.splice(e,1)}else this.$message.error("至少新增一個分類")},addAccount:function(){this.formData.accountList.push({label:"",key:Date.now()})},addAccounts:function(){var t=this;if(this.formData.accountList.length>0){var e=new Set,a=this.formData.accountList.filter((function(t,a){return""!==t.label&&!e.has(t.label)&&e.add(t.label)}));if(0===a.length)return void this.$message.error("至少新增一個分類");this.formData.accountList=a;var n=this.formData.accountList.map((function(t){return t.label})),o=new FormData;o.append("category",n.toString()),D(o).then((function(e){var a=e.data;a.success?(t.formData.accountList.forEach((function(t){delete t.disabled})),t.$parent.setInit(t.formData),t.handleClose()):(t.setInit(),t.$message.warning(a.msg))})).catch((function(t){console.log(t)}))}},createInit:function(){var t=I(this.formData);this.initData=t},setInit:function(){var t=I(this.initData);this.$emit("setInit",t)}}},H=T,W=(a("e8dc"),Object(C["a"])(H,z,M,!1,null,"f7323e1c",null)),Y=W.exports,q={name:"OnlineAnnouncement",components:{Dialog:N,Announcement:A,AddAcounts:Y},data:function(){return{loading:!1,listLoading:!1,tabMapOptions:[{label:"公告欄",key:"all"},{label:"上架中",key:"launched"},{label:"未上架",key:"notLaunch"},{label:"已下架",key:"removed"}],activeName:"all",tableData:[],formData:{accountList:[{label:"",key:Date.now()}]}}},mounted:function(){this.initdata(),this.categoryList()},methods:{checkPermission:c["a"],add:function(){this.$refs.dialog.handleOpen("新增")},edit:function(t){var e=t.title,a=t.row;this.$refs.dialog.handleOpen(e,a)},filterData:function(){switch(this.activeName){case"notLaunch":return this.tableData.filter((function(t,e,a){return"1"===t.status}));case"launched":return this.tableData.filter((function(t,e,a){return"2"===t.status}));case"removed":return this.tableData.filter((function(t,e,a){return"3"===t.status}));case"all":return this.tableData}},categoryList:function(){var t=this;this.listLoading=!0,b().then((function(e){t.listLoading=!1;var a=e.data;if(a.success){if(a.content.length>0){var n=a.content.split(",");t.formData.accountList=n.map((function(t,e){return{label:t,key:Date.now()+e}}))}}else t.$message.warning(a.msg)})).catch((function(t){console.log(t)}))},initdata:function(){var t=this;this.loading=!0,m().then((function(e){var a=e.data;a.success?(t.tableData=Object(r["a"])(a.content),t.tableData=t.tableData.map((function(t){return Object(i["a"])(Object(i["a"])({},t),{},{id:t.id})}))):(t.tableData=[],t.$message.warning(a.msg)),t.loading=!1})).catch((function(t){console.log(t)}))},changeTab:function(t,e){alert()},handleCategory:function(){this.$refs.addAcounts.handleOpen()},setInit:function(t){this.formData=t}}},P=q,J=Object(C["a"])(P,n,o,!1,null,null,null);e["default"]=J.exports},"360d":function(t,e,a){"use strict";a("7ccb")},"6f70":function(t,e,a){},"7ccb":function(t,e,a){},a8bd:function(t,e,a){},cba5:function(t,e,a){"use strict";a("6f70")},e350:function(t,e,a){"use strict";a.d(e,"a",(function(){return o}));a("caad"),a("45fc"),a("ac1f"),a("2532"),a("1276");var n=a("4360");function o(t){if(t&&t instanceof Array&&t.length>0){var e=n["a"].getters&&n["a"].getters.roles,a=e.split(","),o=t,i=a.some((function(t){return o.includes(t)}));return i}return console.error("need roles! Like v-permission=\"['admin','editor']\""),!1}},e8dc:function(t,e,a){"use strict";a("a8bd")}}]);